{% extends 'base.html' %}

{% block content %}

<div class="col-lg-8 col-lg-offset-2">
    <div class="panel panel-default">
        <div class="panel-heading">购物车</div>
        {% if goods.total != 0 %}
        <ul class="list-group">
            <form id="cartForm">
                {% for i in goods.data %}
                <li class="list-group-item" style="padding-bottom: 0px">
                    <div class="row">
                        <div class="col-xs-1 col-md-1" style="width: 1%;margin-left: 2%">
                            <input type="checkbox" checked aria-label="..." onchange="checkboxChange()"
                                value="{{ i.price }}">
                        </div>
                        <div class="col-xs-1 col-md-1">
                            <a href="#" class="thumbnail">
                                <img src="{{ i.avatar }}" alt="...">
                            </a>
                        </div>
                        <div class="col-md-9">
                            <p style="font-size: 22px">{{ i.name }}</p>
                            <p style="font-size: 14px">{{ i.description }}</p>
                        </div>
                        <div class="col-md-1">
                            <p style="color: #f70;font-size: 20px"><strong> ¥ {{ i.price }} </strong></p>
                        </div>

                    </div>
                </li>
                {% endfor %}
            </form>
        </ul>
        {% else %}
        <div class="panel-body">
            <p style="font-size: 24px"> 您没有选中任何商品 </p>
        </div>
        {% endif %}
        <div class="panel-footer" style="padding-bottom: 0px">
            <div class="row">
                <div class="col-lg-3">
                    <p style="color: #f70;font-size: 20px"><strong>总价格: ¥ <span
                                id="total">{{ goods.total }}</span>.00</strong></p>
                </div>
                <div class="col-lg-7"> </div>
                <div class="col-lg-1" style="text-align: right;">
                    <a href="javascript:void(0)" onclick="submit()">付款</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        function checkboxChange() {
            total = 0
            $("#cartForm input[type=checkbox]").each(function (i, e) {
                if ($(e).prop("checked")) {
                    total += parseInt($(e).val())
                }
            })
            $("#total").html(total)
        }

        function submit() {
            $.ajax({
                method: "GET",
                url: "/order",
                success: function (res) {
                    if (res == "success") {
                        alert("付款成功!")
                        window.location.reload()
                    } else {
                        alert("付款失败,请重试！")
                    }
                },
                error: function (e) {
                    console.log(e)
                }
            })
        }
    </script>
    {% endblock %}