<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>index</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
</head>
<script src="/static/js/jquery.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

<body>
    <div class="container-fluid">
        <div class="col-lg-12" style="margin-top: 5%">
            <h1 class="text-center">图书管理系统</h1>
        </div>

        <div class="col-lg-offset-4 col-lg-4" style="margin-top: 3%">
            <form class="form-horizontal" id="login_form">
                {% csrf_token %}
                <div class="form-group">
                    <label class="col-sm-2 control-label">账户名</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="inputEmail3" name="student_id">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">密码: </label>
                    <div class="col-sm-10">
                        <input type="password" class="form-control" name="password">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <div class="radio">
                            <label>
                                <input name="login_opt" checked="checked" type="radio" id="student_radio" value="student">学生登录
                            </label>
                            <label>
                                <input name="login_opt" type="radio" id="teacher_radio" value="teacher">教师登录
                            </label>
                        </div>
                    </div>
                </div>
            </form>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button class="btn btn-default" type="button" data-toggle="modal" data-target="#sign_in">注册</button>
                    <div class="modal fade" id="sign_in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title" id="myModalLabel">
                                        用户注册
                                    </h4>
                                </div>
                                <div class="modal-body">

                                    <form class="form-horizontal" id="sign_in_form" role="form">

                                        <div class="form-group">
                                            <label for="uname" class="col-sm-2 control-label">姓名</label>
                                            <div class="col-sm-9">
                                                <input type="text" id="name" name="name" class="form-control well"
                                                    placeholder="请输入姓名" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="upwd" class="col-sm-2 control-label">学号</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="student_id" class="form-control well"
                                                    placeholder="请输入学号" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="upwd" class="col-sm-2 control-label">密码</label>
                                            <div class="col-sm-9">
                                                <input type="password" name="password" class="form-control well"
                                                    placeholder="请输入密码" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="upwd" class="col-sm-2 control-label">地址</label>
                                            <div class="col-sm-9">
                                                <input type="text" name="address" class="form-control well" placeholder="请输入地址" />
                                            </div>
                                        </div>

                                    </form>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                                    </button>
                                    <button type="button" id="add_btn" class="btn btn-primary" onclick="sign_in_func()">
                                        注册
                                    </button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                    <button class="btn btn-default" type="button" id="login_btn">登录</button>
                </div>
            </div>
            </form>
        </div>
        <div class="col-lg-12">
            <h2 id="head_msg" class="text-center"></h2>
        </div>
    </div>



</body>
<script>

    function sign_in_func() {
        console.log($("#sign_in_form").serialize())
        $.ajax({
            type: "POST",
            url: "/sign_in/",
            data: $("#sign_in_form").serialize(),
            success: function (data) {
                console.log(data)
                if(data == "yes"){
                    alert("注册成功!")
                }else if(data == "no2"){
                    alert("注册失败!学号已存在!")
                }else{
                    alert("注册失败!请检查输入!")
                }
            }
        })
    }
    $("#sign_in_btn").click(function () {
        var sign_in_str = "sign_in"
        current_href = window.location.href
        window.location.href = current_href + sign_in_str
    })
    $("#login_btn").click(function () {
        $.ajax({
            url: "/",
            type: "POST",
            data: $("#login_form").serialize(),
            success: function (data) {
                console.log(data)
                if (data != "true" && data != "admin") {
                    $("#head_msg").html("帐号密码错误")
                } else {
                    if(data == "admin"){
                        window.location.href = "http://" + window.location.host + "/admin_index/"
                    }else{
                        window.location.href = "http://" + window.location.host + "/book_index/"
                    }
                }
            },
            error: function (data) {
                console.log(data)
            }

        })
        console.log()
    })

</script>

</html>